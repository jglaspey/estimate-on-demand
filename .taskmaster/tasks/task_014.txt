# Task ID: 14
# Title: PDF to Image Conversion and Vision Model Testing
# Status: pending
# Dependencies: 4, 2
# Priority: medium
# Description: Fix PDF to image conversion issues and implement alternative methods, then test various vision models (Claude Sonnet 4, Haiku 3.5, Gemini Flash, GPT-5-mini) to compare extraction accuracy against direct PDF and text-based approaches. This is part of the extraction pipeline research under the Database Schema and API Routes task.
# Details:
1. Diagnose current pdf2pic library issues:
   - Identify specific failure modes and error patterns
   - Document environment dependencies and version conflicts
   - Test with various PDF types to isolate problematic scenarios

2. Implement alternative PDF to image conversion methods:
   - Integrate pdf-lib for PDF parsing and manipulation
   - Set up HTML5 Canvas for rendering PDF pages as images
   - Implement server-side fallback using Puppeteer or similar headless browser
   - Create utility functions for controlling resolution, format, and quality
   - Add error handling with graceful degradation to alternative methods

3. Create standardized test dataset:
   - Compile representative sample of project-relevant PDFs
   - Include various complexities: text-heavy, diagram-rich, form-based
   - Create ground truth extraction data for accuracy comparison

4. Implement vision model testing framework:
   - Set up API connections to Claude Sonnet 4, Haiku 3.5, Gemini Flash, and GPT-5-mini
   - Create standardized prompts for extraction tasks
   - Implement parallel testing to ensure consistent comparison
   - Build metrics collection for accuracy, processing time, and token usage

5. Develop comparison methodology:
   - Define metrics for extraction accuracy (precision, recall, F1 score)
   - Create visualization of results across models and methods
   - Implement cost analysis based on API pricing and processing requirements
   - Design hybrid approach combining strengths of different methods

6. Optimize conversion pipeline:
   - Implement caching for converted images to improve performance
   - Add progressive loading for multi-page documents
   - Create compression options for bandwidth optimization
   - Implement batch processing for large documents

# Test Strategy:
1. PDF Conversion Testing:
   - Test conversion with various PDF types (text-heavy, image-heavy, forms)
   - Verify image quality and resolution meets requirements for vision models
   - Measure conversion performance and resource usage
   - Test error handling with malformed or password-protected PDFs
   - Validate multi-page handling and pagination

2. Vision Model Accuracy Testing:
   - Create benchmark suite with ground truth data for extraction tasks
   - Measure precision and recall for each model across different document types
   - Compare extraction accuracy between direct PDF text extraction and vision-based approaches
   - Test with varying image qualities to determine minimum viable resolution
   - Evaluate model performance on text vs. diagram/table extraction

3. Integration Testing:
   - Verify converted images display correctly in the PDF viewer component
   - Test end-to-end workflow from PDF upload through conversion to extraction
   - Validate that highlighting and annotation features work with converted images
   - Test performance under load with large multi-page documents

4. Comparative Analysis:
   - Generate comprehensive report comparing all models and approaches
   - Document cost-benefit analysis of each approach
   - Create decision matrix for selecting optimal extraction method based on document type
   - Validate findings with sample documents not in the training set
